<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ステラソラ 実績クリアチェッカーα</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-color: #4a90e2;
            --gray-done: #333333;
            --border-color: #444;
            --success-color: #2ecc71;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        .container { width: 100%; max-width: 900px; }
        h1 { text-align: center; color: var(--accent-color); margin-bottom: 10px; }

        .total-progress-area {
            background: #252525; padding: 20px; border-radius: 12px; margin-bottom: 20px;
            border: 2px solid var(--accent-color); text-align: center;
        }

        .total-stats { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; display: block; }

        .toolbar {
            background: var(--card-bg); padding: 15px; border-radius: 8px; margin-bottom: 20px;
            display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;
            border: 1px solid var(--border-color); position: sticky; top: 10px; z-index: 100;
        }

        .toolbar label { cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }

        .category { margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; background: var(--card-bg); }
        .category-header { padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: #252525; transition: background 0.3s; }
        .category-header:hover { background: #2d2d2d; }

        .progress-wrapper { flex-grow: 1; margin: 0 20px; display: flex; align-items: center; gap: 10px; }
        .progress-container { flex-grow: 1; background: #444; height: 14px; border-radius: 7px; position: relative; overflow: hidden; }
        .progress-bar { background: var(--accent-color); height: 100%; width: 0%; transition: width 0.4s ease; }
        .progress-bar.complete { background-color: var(--success-color) !important; }
        .pct-label { font-size: 0.85rem; min-width: 45px; text-align: right; font-family: monospace; }
        .complete-badge { color: var(--success-color); font-weight: bold; font-size: 0.8rem; margin-left: 5px; display: none; }

        .category-content { display: none; padding: 0; border-top: 1px solid var(--border-color); }
        .category.open .category-content { display: block; }

        .achievement-item {
            padding: 12px 20px; border-bottom: 1px solid #333; display: grid;
            grid-template-columns: auto 1fr; gap: 15px; align-items: center; transition: background 0.2s;
        }
        .achievement-item.done { background-color: var(--gray-done); }
        .achievement-item.hidden { display: none; }
        .achieve-info h4 { margin: 0 0 5px 0; color: var(--accent-color); font-size: 1rem; }
        .achieve-info p { margin: 2px 0; font-size: 0.85rem; color: #bbb; }
        .reward { color: #ffd700 !important; font-weight: bold; }

        footer { margin-top: 40px; padding: 20px; text-align: center; border-top: 1px solid var(--border-color); font-size: 0.8rem; color: #888; line-height: 1.6; }
        #congrats-msg { display: none; background: linear-gradient(45deg, #2ecc71, #27ae60); color: white; padding: 15px; border-radius: 8px; margin-top: 15px; font-weight: bold; animation: pulse 2s infinite; }

        @keyframes pulse { 0% { opacity: 0.9; } 50% { opacity: 1; transform: scale(1.02); } 100% { opacity: 0.9; } }
        input[type="checkbox"] { transform: scale(1.4); cursor: pointer; }
        #reset-btn { background: #d9534f; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h1>ステラソラ 実績チェッカーα</h1>

    <div class="total-progress-area">
        <span class="total-stats">全実績 合計進捗: <span id="total-count">0/0</span></span>
        <div class="progress-wrapper">
            <div class="progress-container">
                <div id="total-bar" class="progress-bar"></div>
            </div>
            <span id="total-pct" class="pct-label" style="font-size: 1.1rem;">0%</span>
        </div>
        <div id="congrats-msg">✨ おめでとうございます！すべての実績をコンプリートしました！ ✨</div>
    </div>

    <div class="toolbar">
        <label><input type="checkbox" id="sort-undone"> 未達成を上位に表示</label>
        <label><input type="checkbox" id="hide-done"> 達成済みを非表示</label>
        <button id="reset-btn">全てのデータをリセット</button>
    </div>

    <div id="app"></div>

    <footer>
        <p>本ツールはステラソラ二次創作ガイドラインに沿って制作されたファンメイドコンテンツです。Yoster社とは関係ありません。</p>
        <p>本ツールは予告なしに利用を終了する場合があります</p>
        <p>こちらに関するお問い合わせ・要望、また、欠けている実績の情報提供等も大歓迎です！</p>
        <p>メール: ioritoku108@gmail.com | Discord: iori108</p>
    </footer>
</div>

<script>
    const ROMAN = ["", "I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX", "X"];

    // データ生成ロジックの再構築（確実に展開するため、配列push方式に変更）
    const generateAchievementData = () => {
        let categories = [];

        // --- 1. 世界を探索 ---
        let cat1 = [];
        const add1 = (id, name, reward, cond) => cat1.push({id, name, reward, condition: cond});
        
        [5,10,15,20,25,30,40].forEach((n, i) => add1(101+i, `魔王の道 ${ROMAN[i+1]}`, n<20?"星ノ欠片 5":n<40?"星ノ欠片 10":"星ノ欠片 20", `権限レベルが${n}に到達する`));
        [10,20,30,50,100].forEach((n, i) => add1(110+i, `一日一善 ${ROMAN[i+1]}`, i===4?"星ノ欠片 20":(n<30?"星ノ欠片 5":"星ノ欠片 10"), `${n}日ログインする`));
        [10,50,500,1000,3000].forEach((n, i) => add1(120+i, `思わぬ成果 ${ROMAN[i+1]}`, n<1000?"星ノ欠片 5":n==1000?"星ノ欠片 10":"星ノ欠片 20", `合成を${n}回行う`));
        [50,100,150,200].forEach((n, i) => add1(130+i, `順風満帆 ${ROMAN[i+1]}`, n==50?"星ノ欠片 5":n<200?"星ノ欠片 10":"星ノ欠片 20", `実績を${n}件達成する`));
        [100000,600000,3000000,10000000,30000000].forEach((n, i) => add1(140+i, `太っ腹 ${ROMAN[i+1]}`, n<3000000?"星ノ欠片 5":n<30000000?"星ノ欠片 10":"星ノ欠片 20", `${n.toLocaleString()}ドーラを消費する`));
        [600,2000,5000,10000,24000].forEach((n, i) => add1(150+i, `星のキラメキ ${ROMAN[i+1]}`, n<5000?"星ノ欠片 5":n<24000?"星ノ欠片 10":"星ノ欠片 20", `入塔記念チケットを${n.toLocaleString()}枚消費する`));
        [5,10,20,30,50,70].forEach((n, i) => add1(160+i, `カンパニー拡大中 ${ROMAN[i+1]}`, "星ノ欠片 20", `ガチャで巡遊者を${n}回獲得する`));
        [50,100,200,300,400,500].forEach((n, i) => add1(170+i, `積極採用 ${ROMAN[i+1]}`, "星ノ欠片 20", `ガチャを${n}回行う`));
        [1,2,3,4,5,6,7,8,9].forEach(i => add1(180+i, `千里の道も一歩から ${ROMAN[i]}`, i<4?"星ノ欠片 5":i<8?"星ノ欠片 10":"星ノ欠片 20", `魔王育成第${i}章をクリアする`));
        [10,20,30,100,200,500].forEach((n, i) => add1(190+i, `頼れる助っ人 ${ROMAN[i+1]}`, n<=20?"星ノ欠片 5":n==30?"星ノ欠片 10":"星ノ欠片 20", `依頼を${n}回完了する`));
        
        add1(201, "駆け出し巡遊者", "星ノ欠片 10", "原初の迷路と他の星の塔を各1回クリアする");
        add1(202, "アッシュエリアの風", "名誉称号「アッシュエリアの風」", "メインストーリー第一章をクリアする");
        add1(203, "水道橋の英雄", "名誉称号「水道橋の英雄」", "メインストーリー第二章をクリアする");
        add1(204, "花咲サポーター", "名誉称号「花咲サポーター」", "メインストーリー第三章をクリアする");
        add1(205, "ユメカウツツカ", "星ノ欠片 5", "メインストーリー「未来のない巡遊者」をクリアする");
        add1(206, "安定雇用", "星ノ欠片 5", "メインストーリー「変わらないもの」をクリアする");
        add1(207, "甘い罠", "名誉称号「甘い罠」", "メインストーリー第四章をクリアする");
        add1(208, "MVP従業員", "名誉称号「MVP従業員」", "メインストーリー第五章をクリアする");
        add1(209, "夜と彩る銀の星", "名誉称号「夜を彩る銀の星」", "メインストーリー第六章をクリアする");

        categories.push({ category: "世界を探索", items: cat1 });

        // --- 2. 星狩りの旅 ---
        let cat2 = [];
        const add2 = (id, name, reward, cond) => cat2.push({id, name, reward, condition: cond});

        add2(301, "視界不良", "星ノ欠片 10", "原初の迷路を1回クリアする");
        [1,2,3,4,5,6,7].forEach(i => add2(310+i, `水面に沈む ${ROMAN[i]}`, i<=4?"星ノ欠片 5":"星ノ欠片 10", `流水と暗影の難易度${i}を1回クリアする`));
        [1,2,3,4,5,6,7].forEach(i => add2(320+i, `灼熱の大地 ${ROMAN[i]}`, i<=4?"星ノ欠片 5":"星ノ欠片 10", `烈火と泥鉱の難易度${i}を1回クリアする`));
        [1,2,3,4,5,6,7].forEach(i => add2(330+i, `大気を裂く雷 ${ROMAN[i]}`, i<=4?"星ノ欠片 5":"星ノ欠片 10", `暴風と雷光の難易度${i}を1回クリアする`));
        [2,4,6,7].forEach((n, i) => add2(340+i, `手広く対応 ${ROMAN[i+1]}`, n==2?"星ノ欠片 5":n<7?"星ノ欠片 10":"星ノ欠片 20", `3つの星ノ塔で難易度${n}をクリアする`));
        [3,10,30,50,100].forEach((n, i) => add2(350+i, `習うより慣れろ ${ROMAN[i+1]}`, n<=10?"星ノ欠片 5":n<=50?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔を${n}回クリアする`));
        add2(361, "逸材", "星ノ欠片 5", "緑色の記録を獲得する");
        add2(362, "卓越", "星ノ欠片 5", "青色の記録を獲得する");
        add2(363, "鍛錬の極み", "星ノ欠片 10", "金色の記録を獲得する");
        add2(364, "至高の域", "星ノ欠片 20", "虹色の記録を獲得する");
        add2(365, "エースメンター", "星ノ欠片 20", "虹色の記録を10回獲得する");

        ["水","火","地","風","光","闇"].forEach((attr, idx) => {
            [5,10,20,50].forEach((n, i) => {
                add2(3000 + (idx*10) + i, `${attr}のエキスパート ${ROMAN[i+1]}`, n<=10?"星ノ欠片 5":n==20?"星ノ欠片 10":"星ノ欠片 20", `${attr}属性のみのチームで星ノ塔を${n}回クリアする`);
            });
        });

        // 音符（13種類 × 5段階）
        ["強撃","幸運","爆発","体力","集中","器用","必殺","水","火","風","地","光","闇"].forEach((note, idx) => {
            [100,500,1200,3000,5000].forEach((n, i) => {
                add2(4000 + (idx*10) + i, `絶対音感・${note} ${ROMAN[i+1]}`, n==100?"星ノ欠片 5":n<=1200?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔で${note}の音符を${n}個獲得する`);
            });
        });

        [10,50,200,500,1000,1600,2200,2800,4000,6000].forEach((n, i) => add2(3100+i, `コンビニの常連 ${ROMAN[i+1]}`, n<=1600?"星ノ欠片 5":n==2200?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔のコンビニで${n}回買い物する`));
        [20,60,150,300,450,600,750,900,1200,1500].forEach((n, i) => add2(3200+i, `偶然の出会い ${ROMAN[i+1]}`, n<=600?"星ノ欠片 5":n==750?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔でイベントを${n}回発生させる`));
        [2000,60000,140000,350000,650000,999999].forEach((n, i) => add2(3300+i, `大富豪 ${ROMAN[i+1]}`, n<=60000?"星ノ欠片 5":n<=350000?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔でステラコインを${n}枚獲得する`));
        [100,250,500,1200,2000,3000].forEach((n, i) => add2(3400+i, `さらなる高みへ ${ROMAN[i+1]}`, n<=250?"星ノ欠片 5":n<=1200?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔で戦闘の間を${n}回発見する`));
        [30,80,200,500,800,1200,1600].forEach((n, i) => add2(3500+i, `お掃除マスター ${ROMAN[i+1]}`, n<=80?"星ノ欠片 5":n<=500?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔で強敵の間を${n}回発見する`));
        [20,40,80,200,320,480,660].forEach((n, i) => add2(3600+i, `正々堂々 ${ROMAN[i+1]}`, n<=40?"星ノ欠片 5":n<=200?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔で首領の間を${n}回発見する`));
        [10,20,40,100,160,240,320].forEach((n, i) => add2(3700+i, `星狩り ${ROMAN[i+1]}`, n<=20?"星ノ欠片 5":n<=100?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔で魔王の間を${n}回発見する`));
        [40,80,160,400,640,960,1200].forEach((n, i) => add2(3800+i, `いらっしゃいませ ${ROMAN[i+1]}`, n<=80?"星ノ欠片 5":n<=400?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔で取引の間を${n}回発見する`));
        [30,90,200,600,1000,1500].forEach((n, i) => add2(3900+i, `休息タイム ${ROMAN[i+1]}`, n<=90?"星ノ欠片 5":n<=600?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔で決断の間を${n}回発見する`));
        [10,20,30,40,50,60,70,80,90].forEach((n, i) => add2(4100+i, `偶然のめぐりあわせ ${ROMAN[i+1]}`, n<=20?"星ノ欠片 5":n<=50?"星ノ欠片 10":"星ノ欠片 20", `図鑑に逸話ノートを${n}個登録する`));
        [30,60,90,120,150,180,210,240,270].forEach((n, i) => add2(4200+i, `秘めた力 ${ROMAN[i+1]}`, n<=60?"星ノ欠片 5":n<=150?"星ノ欠片 10":"星ノ欠片 20", `図鑑に素質を${n}個登録する`));
        [2,10,70,250,500,750,1000,1250,1750,2500].forEach((n, i) => add2(4300+i, `素質解放 ${ROMAN[i+1]}`, n<=10?"星ノ欠片 5":n<=500?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔で強化マシンを${n}回使用する`));
        [5,10,20,50,100].forEach((n, i) => add2(4400+i, `もう少し考える ${ROMAN[i+1]}`, n<=10?"星ノ欠片 5":n==20?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔で再抽選を${n}回行う`));
        [5,10,30,50,100].forEach((n, i) => add2(4500+i, `商品入れ替え ${ROMAN[i+1]}`, n<=10?"星ノ欠片 5":n<=50?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔でコンビニのラインナップ更新を${n}回行う`));
        [5,10,20,50,100].forEach((n, i) => add2(4600+i, `ほとばしる力 ${ROMAN[i+1]}`, n<=10?"星ノ欠片 5":n==20?"星ノ欠片 10":"星ノ欠片 20", `素質獲得時に歓喜の心を${n}回発動する`));
        [5,10,20,50,100].forEach((n, i) => add2(4700+i, `強化昇格 ${ROMAN[i+1]}`, n<=10?"星ノ欠片 5":n==20?"星ノ欠片 10":"星ノ欠片 20", `素質強化時に素質飛昇を${n}回発動する`));
        [5,20,200,1000,2000].forEach((n, i) => add2(4800+i, `バーゲンセール ${ROMAN[i+1]}`, n<=20?"星ノ欠片 5":n==200?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔のコンビニで割引アイテムを${n}回購入する`));
        [1,6,30,90,200,300,400,500,700,1000].forEach((n, i) => add2(4900+i, `ロスレコ共鳴 ${ROMAN[i+1]}`, n<=6?"星ノ欠片 5":n<=200?"星ノ欠片 10":"星ノ欠片 20", `星ノ塔でロスレコのアシスト効果を${n}回解放する`));

        categories.push({ category: "星狩りの旅", items: cat2 });

        // --- 3. 戦果累々 ---
        let cat3 = [];
        const add3 = (id, name, reward, cond) => cat3.push({id, name, reward, condition: cond});

        [20,40,80,240].forEach((n, i) => add3(501+i, `切磋琢磨 ${ROMAN[i+1]}`, n<=40?"星ノ欠片 5":"星ノ欠片 10", `技能研修を${n}回クリアする`));
        [20,40,80,240,480].forEach((n, i) => add3(511+i, `熟練の技 ${ROMAN[i+1]}`, n<=40?"星ノ欠片 5":"星ノ欠片 10", `昇格試練を${n}回クリアする`));
        [30,60,120].forEach((n, i) => add3(521+i, `初心忘れるべからず ${ROMAN[i+1]}`, n<=60?"星ノ欠片 5":"星ノ欠片 10", `基礎研修を${n}回クリアする`));

        // チャンピオンベルト
        ["無","風","地","闇","火","水","光"].forEach((type, tidx) => {
            [1,2,3,4,5,6].forEach(lv => {
                const stageName = type=='無'?'無限アリーナ':type=='風'?'涼風の調べ':type=='地'?'古城の喊声':type=='闇'?'密室の儀式':type=='火'?'灼熱の狂舞':type=='水'?'麗しの流歌':'閃光の饗宴';
                add3(6000 + (tidx*10) + lv, `チャンピオンベルト・${type} ${ROMAN[lv]}`, lv<=2?"星ノ欠片 5":lv<=5?"星ノ欠片 10":"星ノ欠片 20", `無限リングで${stageName}・難易度${lv}をクリアする`);
            });
        });

        // ボス報酬
        ["怪奇ノ霊","癒悦ノ光","空壺ノ王"].forEach((boss, bidx) => {
            [10,20,50,100].forEach((n, i) => {
                const title = bidx==0?'ゴーストハント':bidx==1?'お茶の子さいさい':'パンプアップ';
                add3(7000 + (bidx*10) + i, `${title} ${ROMAN[i+1]}`, n<100?"星ノ欠片 5":"星ノ欠片 10", `昇格試練で${boss}を${n}回クリアする`);
            });
        });
        add3(750, "もはや敵なし", "星ノ欠片 20", "昇格試練で3種類の首領の難易度8ステージを★3でクリアする");

        // 属性印
        ["水","火","地","風","光","闇"].forEach((attr, idx) => {
            [10,50,100,300,500,1000].forEach((n, i) => {
                const title = attr=='水'?'絶え間なき奔流':attr=='火'?'燃え上がる烈火':attr=='地'?'鳴動する大地':attr=='風'?'うずまく風':attr=='光'?'まばゆい光':'深き闇夜';
                add3(8000 + (idx*10) + i, `${title} ${ROMAN[i+1]}`, n<=50?"星ノ欠片 5":n==100?"星ノ欠片 10":"星ノ欠片 20", `${attr}属性の印を${n}回発動する`);
            });
        });

        [10,20,50,100,300,500,1000].forEach((n, i) => add3(9000+i, `究極奥義 ${ROMAN[i+1]}`, n<=20?"星ノ欠片 5":n==50?"星ノ欠片 10":"星ノ欠片 20", `必殺技を${n}回発動する`));
        [10,20,50,100,300,500,1000].forEach((n, i) => add3(10000+i, `専売特許 ${ROMAN[i+1]}`, n<=20?"星ノ欠片 5":n==50?"星ノ欠片 10":"星ノ欠片 20", `主力スキルを${n}回発動する`));
        [10,20,50,100,300,500,1000].forEach((n, i) => add3(11000+i, `頼もしき支援 ${ROMAN[i+1]}`, n<=20?"星ノ欠片 5":n==50?"星ノ欠片 10":"星ノ欠片 20", `支援スキルを${n}回発動する`));

        add3(11501, "至高の一撃 I", "星ノ欠片 20", "一回の攻撃で9999以上のダメージを与える");
        add3(11502, "至高の一撃 II", "星ノ欠片 20", "一回の攻撃で99999以上のダメージを与える");
        add3(11503, "至高の一撃 III", "星ノ欠片 20", "一回の攻撃で999999以上のダメージを与える");
        add3(11504, "危機一髪 I", "星ノ欠片 20", "HPが10%以下の状態でステージをクリア");
        add3(11505, "危機一髪 II", "星ノ欠片 20", "HPが5%以下の状態でステージをクリア");

        [10,20,50,100].forEach((n, i) => add3(11600+i, `厄災の守護者 ${ROMAN[i+1]}`, n<=20?"星ノ欠片 5":n==50?"星ノ欠片 10":"星ノ欠片 20", `骸魔防衛戦を${n}回クリアする`));
        [3,20,50,200].forEach((n, i) => add3(11700+i, `数々の功績 ${ROMAN[i+1]}`, n<=20?"星ノ欠片 5":"星ノ欠片 10", `徽章試練を${n}回クリアする`));

        // ボスギミック系
        const bossGimmicks = [
            {id:12001,n:"手を出すな",c:"両手を破壊した状態で太古ノ巨神兵を撃破する"},
            {id:12002,n:"日焼け対策",c:"太古ノ巨神兵のレーザー攻撃を受ける"},
            {id:12003,n:"メカ対策のスペシャリスト",c:"ダメージを受けずに太古ノ巨神兵を撃破する"},
            {id:12004,n:"調教師",c:"破砕ノ牙の猪突爆進の発動を中断させる"},
            {id:12005,n:"獣と踊る",c:"破砕ノ牙の猪突爆進の発動中にダメージを受けない"},
            {id:12006,n:"角に注意",c:"破砕ノ牙の猪突爆進を3回以上受ける"},
            {id:12007,n:"巨大獣捕獲のスペシャリスト",c:"ダメージを受けずに破砕ノ牙を撃破する"},
            {id:12008,n:"植物学者",c:"未恋ノ禍実のツボミを破壊せずにクリアする"},
            {id:12009,n:"動物好き",c:"フィールド上にウッドモットが生存せいている状態で未恋ノ禍実を撃破する"},
            {id:12010,n:"清廉潔白",c:"ダメージを受けずに未恋ノ禍実をクリアする"},
            {id:12011,n:"湿度管理",c:"ゼリゼリキングの再合体を阻止する"},
            {id:12012,n:"きれいさっぱり",c:"ゼリゼリキング再合体後の衝撃波を回避する"},
            {id:12013,n:"混沌の終わり",c:"ダメージを受けずに不朽ノ砦をクリアする"},
            {id:12014,n:"朽ちない意思",c:"不朽ノ砦の広範囲攻撃をジャスト回避する"},
            {id:12015,n:"汚れ知らず",c:"毒池の影響を受けずに深層ノ主を撃破する"},
            {id:12016,n:"怒らないで",c:"深層ノ主の狂暴状態を中断させる"},
            {id:12017,n:"トップダンサー",c:"ダメージを受けずに怪奇ノ霊を撃破する"},
            {id:12018,n:"ビートを刻め",c:"戦闘中に、怪奇ノ霊がリピート演奏を発動する"},
            {id:12019,n:"パーフェクトステップ",c:"1回の怪奇ノ霊との戦闘中にジャスト回避を10回成功させる"},
            {id:12020,n:"未然に防ぐ",c:"空壺ノ王がブレイク状態の時に撃破する"},
            {id:12021,n:"情けは無用",c:"空壺ノ王がツボの姿の時に撃破する"},
            {id:12022,n:"食事中はお静かに",c:"狂気ノ料理人のカトラリーの回収を全て阻止する"},
            {id:12023,n:"夢の終わり",c:"ナイトメアデミスが狂暴状態に入る前に撃破する"},
            {id:12024,n:"脳内手術",c:"ナイトメアデミスを10秒以内に3体撃破する"},
            {id:12025,n:"熟練のハンター",c:"ナイトメアソルジャーの突進技を受けずに撃破する"},
            {id:12026,n:"未熟なハンター",c:"1回の戦闘中、ナイトメアソルジャーの突撃を5回受ける"},
            {id:12027,n:"ハンターの直感",c:"ナイトメアソルジャーの必殺技を中断させる"},
            {id:12028,n:"ノー・モア・ナイトメア",c:"ダメージを受けずにナイトメアソルジャーを撃破する"},
            {id:12029,n:"一人ぼっち",c:"フィールド上に存在する敵がいない時にシャド―リーパーを撃破する"},
            {id:12030,n:"塵と化す",c:"ダメージを受けずにシャド―リーパーをクリアする"},
            {id:12031,n:"エサ撒き",c:"翠煌ノ刃のハチドリブリッツの発動中にスキルの中心にいる"},
            {id:12032,n:"三連回避",c:"1回の戦闘で5回ジャスト回避する"},
            {id:12033,n:"電光石火",c:"翠煌ノ刃との戦闘中に召喚物のダメージを受けない"},
            {id:12034,n:"柳に風",c:"幻惑ノ花との戦闘中に竜巻のダメージを受けない"},
            {id:12035,n:"盾を突く",c:"バスターアームのクロールスキルを1回中断させる"},
            {id:12036,n:"単刀直入",c:"周囲の敵を撃破せずにフレグラミートを撃破する"}
        ];
        bossGimmicks.forEach(b => add3(b.id, b.n, "星ノ欠片 20", b.c));

        ["ゼリゼリ","ツボツボ","メカ","衛兵","メイジ"].forEach((type, tidx) => {
            [200, 1000].forEach((n, i) => add3(13000+(tidx*10)+i, `対${type}${i==0?'マスター':'グランドマスター'}`, i==0?"星ノ欠片 5":"星ノ欠片 10", `星ノ塔で${type}タイプの敵を${n}体撃破する`));
        });

        categories.push({ category: "戦果累々", items: cat3 });

        // --- 4. 鍛錬の成果 ---
        let cat4 = [];
        const add4 = (id, name, reward, cond) => cat4.push({id, name, reward, condition: cond});

        [10,20,30,40,50].forEach((n, i) => add4(14001+i, `世渡り上手 ${ROMAN[i+1]}`, n<=30?"星ノ欠片 5":n==40?"星ノ欠片 10":"星ノ欠片 20", `巡遊者の昇格を${n}回行う`));
        [10,20,30,40,50].forEach((n, i) => add4(14101+i, `調和するメロディ ${ROMAN[i+1]}`, n<=30?"星ノ欠片 5":n==40?"星ノ欠片 10":"星ノ欠片 20", `ロスレコの昇格を${n}回行う`));
        
        [20,30,50,90].forEach((lv, i) => add4(14201+i, `精鋭揃い ${ROMAN[i+1]}`, lv<=30?"星ノ欠片 5":lv==50?"星ノ欠片 10":"星ノ欠片 10", `巡遊者3人をLv.${lv}にする`));
        add4(14205, "精鋭揃い V", "星ノ欠片 10", "巡遊者6人をLv.90にする");
        add4(14206, "精鋭揃い VI", "星ノ欠片 5", "巡遊者9人をLv.90にする");

        ["水","火","地","風","光","闇"].forEach((attr, idx) => {
            [20,30,50,90].forEach((lv, i) => {
                add4(14300 + (idx*10) + i, `${attr}の専門家 ${ROMAN[i+1]}`, lv<=30?"星ノ欠片 5":lv==50?"星ノ欠片 10":"星ノ欠片 20", `${attr}属性の巡遊者3人をLv.${lv}にする`);
            });
        });

        [20,30,50,90].forEach((lv, i) => add4(14401+i, `秘蔵コレクション ${ROMAN[i+1]}`, lv<=30?"星ノ欠片 5":lv==50?"星ノ欠片 10":"星ノ欠片 10", `ロスレコ3枚をLv.${lv}にする`));
        [10,20,30,40,50].forEach((n, i) => add4(14501+i, `レコードコレクター ${ROMAN[i+1]}`, n<=20?"星ノ欠片 5":n<=40?"星ノ欠片 10":"星ノ欠片 20", `ロスレコを${n}枚獲得する`));
        [5,10,15].forEach((n, i) => add4(14601+i, `レコードマニア ${ROMAN[i+1]}`, "星ノ欠片 20", `★5のロスレコを${n}枚獲得する`));

        add4(14701, "良縁成就 I", "星ノ欠片 5", "巡遊者10人を獲得する");
        add4(14702, "良縁成就 II", "星ノ欠片 5", "巡遊者20人を獲得する");
        add4(14801, "ドリームチーム I", "星ノ欠片 20", "★5の巡遊者5人を獲得する");
        add4(14802, "ドリームチーム II", "星ノ欠片 20", "★5の巡遊者10人を獲得する");

        [3,10,15,20].forEach((n, i) => add4(14901+i, `努力あるのみ ${ROMAN[i+1]}`, n<=10?"星ノ欠片 5":"星ノ欠片 10", `巡遊者${n}人のスキルを${n==20?'Lv.7':'Lv.4'}に強化する`));

        categories.push({ category: "鍛錬の成果", items: cat4 });

        // --- 5. 旅路の絆 ---
        let cat5 = [];
        const add5 = (id, name, reward, cond) => cat5.push({id, name, reward, condition: cond});

        [10,20,50,100,200,500].forEach((n, i) => add5(15001+i, `ささやかな贈り物 ${ROMAN[i+1]}`, n<=20?"星ノ欠片 5":n<=200?"星ノ欠片 10":"星ノ欠片 20", `ギフトを${n}回贈る`));
        [5,10,20,50,100].forEach((n, i) => add5(15101+i, `優しさの欠片 ${ROMAN[i+1]}`, n<=10?"星ノ欠片 5":n<=50?"星ノ欠片 10":"星ノ欠片 20", `デートを${n}回完了する`));
        [5,10,20,50,100].forEach((n, i) => add5(15201+i, `ナイショ話 ${ROMAN[i+1]}`, n<=10?"星ノ欠片 5":n<=50?"星ノ欠片 10":"星ノ欠片 20", `チャットを${n}回完了する`));

        categories.push({ category: "旅路の絆", items: cat5 });

        return categories;
    };

    const achievementData = generateAchievementData();

    let status = JSON.parse(localStorage.getItem('stella-sora-full-final-v6')) || {};
    let openCategories = {};

    function render() {
        const app = document.getElementById('app');
        const sortUndone = document.getElementById('sort-undone').checked;
        const hideDone = document.getElementById('hide-done').checked;

        document.querySelectorAll('.category').forEach((el, idx) => { openCategories[idx] = el.classList.contains('open'); });

        app.innerHTML = '';
        let totalItemsCount = 0;
        let totalDoneCount = 0;

        achievementData.forEach((cat, index) => {
            const count = cat.items.length;
            const doneCount = cat.items.filter(i => status[i.id]).length;
            const pct = count > 0 ? Math.floor((doneCount / count) * 100) : 0;
            const isComplete = (doneCount === count && count > 0);

            totalItemsCount += count;
            totalDoneCount += doneCount;

            const catDiv = document.createElement('div');
            catDiv.className = 'category';
            if (openCategories[index]) catDiv.classList.add('open');

            let displayItems = [...cat.items];
            if (sortUndone) { displayItems.sort((a, b) => (status[a.id] === status[b.id] ? 0 : status[a.id] ? 1 : -1)); }

            const itemsHtml = displayItems.map(item => {
                const isItemDone = status[item.id] || false;
                return `
                    <div class="achievement-item ${isItemDone ? 'done' : ''} ${isItemDone && hideDone ? 'hidden' : ''}">
                        <input type="checkbox" ${isItemDone ? 'checked' : ''} onchange="toggleAchievement(${item.id})">
                        <div class="achieve-info">
                            <h4>${item.name}</h4>
                            <p class="reward">報酬: ${item.reward}</p>
                            <p>${item.condition}</p>
                        </div>
                    </div>
                `;
            }).join('');

            catDiv.innerHTML = `
                <div class="category-header" onclick="toggleCategory(this, ${index})">
                    <strong>${cat.category} (${doneCount}/${count})${isComplete?' <span style="color:#2ecc71">★</span>':''}</strong>
                    <div class="progress-wrapper">
                        <div class="progress-container">
                            <div class="progress-bar ${isComplete?'complete':''}" style="width: ${pct}%"></div>
                        </div>
                        <span class="pct-label" style="color:${isComplete?'var(--success-color)':'inherit'}">${pct}%</span>
                    </div>
                    <span>▼</span>
                </div>
                <div class="category-content">${itemsHtml}</div>
            `;
            app.appendChild(catDiv);
        });

        const totalPct = totalItemsCount > 0 ? Math.floor((totalDoneCount / totalItemsCount) * 100) : 0;
        const totalComplete = (totalDoneCount === totalItemsCount && totalItemsCount > 0);
        document.getElementById('total-count').textContent = `${totalDoneCount} / ${totalItemsCount}`;
        const totalBar = document.getElementById('total-bar');
        totalBar.style.width = `${totalPct}%`;
        if(totalComplete) totalBar.classList.add('complete'); else totalBar.classList.remove('complete');
        document.getElementById('total-pct').textContent = `${totalPct}%`;
        document.getElementById('congrats-msg').style.display = totalComplete ? 'block' : 'none';
    }

    window.toggleCategory = (el, index) => {
        const p = el.parentElement;
        p.classList.toggle('open');
        openCategories[index] = p.classList.contains('open');
    };

    window.toggleAchievement = (id) => {
        status[id] = !status[id];
        localStorage.setItem('stella-sora-full-final-v6', JSON.stringify(status));
        render();
    };

    document.getElementById('reset-btn').onclick = () => {
        if(confirm('注意：全ての進捗データが削除されます。よろしいですか？')) {
            status = {};
            localStorage.setItem('stella-sora-full-final-v6', JSON.stringify(status));
            render();
        }
    };

    document.getElementById('sort-undone').onchange = render;
    document.getElementById('hide-done').onchange = render;
    render();
</script>
</body>
</html>
